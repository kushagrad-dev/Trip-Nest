<style>
  /* NOTIFICATION BELL */
  .notification-wrapper{
    position:relative;
    margin-right:1rem;
    cursor:pointer;
  }

  .notification-badge{
    position:absolute;
    top:-4px;
    right:-6px;
    background:#fe424d;
    color:#fff;
    font-size:.65rem;
    padding:2px 6px;
    border-radius:50px;
  }

  .notification-dropdown{
    display:none;
    position:absolute;
    right:0;
    top:130%;
    width:260px;
    background:#fff;
    border-radius:12px;
    box-shadow:0 10px 25px rgba(0,0,0,0.12);
    padding:.75rem;
    z-index:999;
  }

  .notification-dropdown.show{
    display:block;
  }

  .notification-item{
    padding:.5rem;
    border-radius:8px;
    font-size:.9rem;
  }

  .notification-item:hover{
    background:#f8f9fa;
  }
  .btn-outline-danger {
    background-color: #fe424d;
    border-color: #fe424d;
    color: #fff;
  }

  .btn-outline-danger:hover {
    border-color: #fe424d;
    color: #fff;
  }

  .btn-search i{
    display:inline;
    margin-right:.5rem;
  }

  .btn-search{
    display:inline;
    margin-right:.5rem;
    border-radius:25px;
    padding:0 1rem;
    transition:.25s ease;
    box-shadow:0 2px 10px rgba(254,66,77,0.25);
    background:linear-gradient(45deg,#fe424d,#ff7a82);
    border:none;
    color:#fff;
  }

  .btn-search:hover{
    transform:translateY(-2px) scale(1.03);
    box-shadow:0 6px 18px rgba(254,66,77,0.35);
    background:linear-gradient(45deg,#ff7a82,#fe424d);
  }

  .btn-search-placeholder{
    border-radius:25px;
    padding:.5rem 3rem;
    font-size:1rem !important;
    text-align:center;
  }

  .btn-search-placeholder::placeholder{
    text-align:center;
  }

  .navbar{
    background-color:#fff;
    backdrop-filter:blur(10px);
    box-shadow:0 2px 18px rgba(0,0,0,0.06);
    transition:all .25s ease;
  }

  .navbar.scrolled{
    padding-top:6px !important;
    padding-bottom:6px !important;
    backdrop-filter:blur(14px);
    box-shadow:0 6px 25px rgba(0,0,0,0.08);
  }

  .navbar-nav .nav-link{
    margin-right:1rem;
    position:relative;
    font-weight:500;
    transition:.25s ease;
    background:#fff;
  }

  .navbar-nav .nav-link::after{
    content:"";
    position:absolute;
    left:0;
    bottom:-4px;
    width:0%;
    height:2px;
    background:#fe424d;
    transition:.3s ease;
    border-radius:10px;
  }

  .navbar-nav .nav-link:hover::after{
    width:100%;
  }

  .navbar-nav .nav-link:hover{
    transform:translateY(-1px);
    background:linear-gradient(45deg,#fe424d,#ff7a82);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
  }

  .navbar-nav .nav-link.active{
    color:#fe424d !important;
    font-weight:600;
  }

  .navbar-nav .nav-link.active::after{
    width:100%;
  }

  .navbar-brand i{
    transition:.3s ease;
  }

</style>
<style>

  /* TOGGLER VISIBILITY */
  .navbar-toggler{
    background:#ffffff;
    border:1px solid #ddd;
    padding:6px 10px;
  }

  .navbar-toggler:focus{
    box-shadow:none;
  }

  .navbar-toggler-icon{
    filter: invert(1);
  }

  /* SEARCH POSITION FIX */
  @media (max-width:767px){
    .navbar .flex-grow-1{
      margin: top 14px;
    }
  }

  .d-flex.justify-content-center.flex-grow-1{
    background:#ffffff;
  }

  .navbar.scrolled .flex-grow-1{
    background:#ffffff;
  }

  /* MOBILE DROPDOWN BACKGROUND FIX */
  @media (max-width:767px){
    .navbar-collapse{
      background:#ffffff;
      padding:12px;
      margin-top:-6px;
      border-radius:0 0 14px 14px;
      box-shadow:0 8px 20px rgba(0,0,0,0.08);
    }
  }
</style>

<nav class="navbar navbar-expand-md border-bottom sticky-top" data-user="<%= currUser ? 'logged-in' : 'guest' %>">
  <div class="container-fluid">

    <a class="navbar-brand" href="/listings">
      <i class="fa-solid fa-compass"></i>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">

      <!-- LEFT -->
      <div class="navbar-nav bg-white">
        <a class="nav-link" href="/listings"><b>Explore</b></a>
      </div>

      <!-- CENTER SEARCH -->
      <div class="d-flex justify-content-center flex-grow-1">
        <div class="w-100 d-flex justify-content-center">
          <div class="w-75">
            <form class="d-flex justify-content-center w-100" role="search" method="GET" action="/listings">
              <input class="btn-search-placeholder form-control me-2 ms-auto" type="search" name="search" placeholder="Search destinations">
              <select name="category" class="form-select me-2" style="max-width:170px;border-radius:25px;">
                <option value="">All Categories</option>
                <option value="Trending">Trending</option>
                <option value="Rooms">Rooms</option>
                <option value="Cities">Cities</option>
                <option value="Mountains">Mountains</option>
                <option value="Castles">Castles</option>
                <option value="Pools">Pools</option>
                <option value="Camping">Camping</option>
                <option value="Farms">Farms</option>
                <option value="Arctic">Arctic</option>
              </select>
              <button class="btn btn-search" type="submit">
                <i class="fa-solid fa-magnifying-glass"></i>Search
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="navbar-nav ms-auto bg-white">
        <a class="nav-link" href="/listings/new">TripNest your home</a>

        <% if(currUser){ %>
          <div class="notification-wrapper" id="notifBell">
            <i class="fa-solid fa-bell"></i>
            <span class="notification-badge" id="notifCount">3</span>

            <div class="notification-dropdown" id="notifDropdown">
              <div class="notification-item">New booking request</div>
              <div class="notification-item">Booking approved</div>
              <div class="notification-item">New review received</div>
            </div>
          </div>
        <% } %>

        <% if (!currUser) { %>
          <a class="nav-link" href="/signup"><b>Trip up</b></a>
          <a class="nav-link" href="/login"><b>Trip in</b></a>
        <% } else { %>

          <% if(currUser.role === "admin" || currUser.username === "Trip Analyst"){ %>
            <a class="nav-link" href="/bookings/admin/bookings"><b>Bookings</b></a>
          <% } %>

          <a class="nav-link" href="/logout"><b>Trip out</b></a>
        <% } %>
      </div>

    </div>
  </div>
</nav>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const nav = document.querySelector(".navbar");
  if(!nav) return;

  // ACTIVE LINK DETECTION
  const currentPath = window.location.pathname;
  document.querySelectorAll(".navbar-nav .nav-link").forEach(link=>{
    if(link.getAttribute("href")===currentPath){
      link.classList.add("active");
    }
  });

  // SCROLL EFFECT
  window.addEventListener("scroll",()=>{
    if(window.scrollY>20) nav.classList.add("scrolled");
    else nav.classList.remove("scrolled");
  });

  // NOTIFICATION TOGGLE
  const bell = document.getElementById("notifBell");
  const dropdown = document.getElementById("notifDropdown");

  if(bell && dropdown){
    bell.addEventListener("click", (e)=>{
      e.stopPropagation();
      dropdown.classList.toggle("show");
    });

    document.addEventListener("click", ()=>{
      dropdown.classList.remove("show");
    });
  }

});
</script>