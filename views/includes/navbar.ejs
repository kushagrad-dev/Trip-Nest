<style>

  /* TOGGLER VISIBILITY */
  .navbar-toggler{
    background:#ffffff;
    border:1px solid #ddd;
    padding:6px 10px;
  }

  .navbar-toggler:focus{
    box-shadow:none;
  }

  .navbar-toggler-icon{
    filter: invert(1);
  }

  /* SEARCH POSITION FIX */
  @media (max-width:767px){
    .navbar .flex-grow-1{
      margin-top: 14px;
    }
  }

  .d-flex.justify-content-center.flex-grow-1{
    background:#ffffff;
  }

  .navbar.scrolled .flex-grow-1{
    background:#ffffff;
  }

  /* MOBILE DROPDOWN BACKGROUND FIX */
  @media (max-width:767px){
    .navbar-collapse{
      background:#ffffff;
      padding:12px;
      margin-top:-6px;
      border-radius:0 0 14px 14px;
      box-shadow:0 8px 20px rgba(0,0,0,0.08);
    }
  }
</style>

<nav class="navbar navbar-expand-md border-bottom sticky-top" data-user="<%= currUser ? 'logged-in' : 'guest' %>">
  <div class="container-fluid">

    <a class="navbar-brand" href="/listings">
      <i class="fa-solid fa-compass"></i>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">

      <!-- LEFT -->
      <div class="navbar-nav bg-white">
        <a class="nav-link" href="/listings"><b>Explore</b></a>
      </div>

      <!-- CENTER SEARCH -->
      <div class="d-flex justify-content-center flex-grow-1">
        <div class="w-100 d-flex justify-content-center">
          <div class="w-75">
            <form class="d-flex justify-content-center w-100" role="search" method="GET" action="/listings">
              <input class="btn-search-placeholder form-control me-2 ms-auto" type="search" name="search" placeholder="Search destinations">
              <select name="category" class="form-select me-2" style="max-width:170px;border-radius:25px;">
                <option value="">All Categories</option>
                <option value="Trending">Trending</option>
                <option value="Rooms">Rooms</option>
                <option value="Cities">Cities</option>
                <option value="Mountains">Mountains</option>
                <option value="Castles">Castles</option>
                <option value="Pools">Pools</option>
                <option value="Camping">Camping</option>
                <option value="Farms">Farms</option>
                <option value="Arctic">Arctic</option>
              </select>
              <button class="btn btn-search" type="submit">
                <i class="fa-solid fa-magnifying-glass"></i>Search
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="navbar-nav ms-auto bg-white">
        <a class="nav-link" href="/listings/new">TripNest your home</a>

        

        <% if (!currUser) { %>
          <a class="nav-link" href="/signup"><b>Trip up</b></a>
          <a class="nav-link" href="/login"><b>Trip in</b></a>
        <% } else { %>

          <% if(currUser.role === "admin" || currUser.username === "Trip Analyst"){ %>
            <a class="nav-link" href="/bookings/admin/bookings"><b>Bookings</b></a>
          <% } %>

          <% if(currUser && (currUser.username==="Trip Analyst" || currUser.role==="admin")){ %>
  <a class="nav-link" href="/admin"><b>Admin Panel</b></a>
<% } %>

          <a class="nav-link" href="/logout"><b>Trip out</b></a>
        <% } %>
      </div>

    </div>
  </div>
</nav>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const nav = document.querySelector(".navbar");
  if(!nav) return;

  // ACTIVE LINK DETECTION
  const currentPath = window.location.pathname;
  document.querySelectorAll(".navbar-nav .nav-link").forEach(link=>{
    if(link.getAttribute("href")===currentPath){
      link.classList.add("active");
    }
  });

  // SCROLL EFFECT
  window.addEventListener("scroll",()=>{
    if(window.scrollY>20) nav.classList.add("scrolled");
    else nav.classList.remove("scrolled");
  });

  // NOTIFICATION TOGGLE
  const bell = document.getElementById("notifBell");
  const dropdown = document.getElementById("notifDropdown");

  if(bell && dropdown){
    bell.addEventListener("click", (e)=>{
      e.stopPropagation();
      dropdown.classList.toggle("show");
    });

    document.addEventListener("click", ()=>{
      dropdown.classList.remove("show");
    });
  });
});
</script>